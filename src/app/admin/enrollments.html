<app-layout [menuItems]="menuItems" [userName]="userName" (logoutEvent)="logout()">
    <div class="scholarship-container">
        <!-- Hero Header -->
        <div class="hero-header">
            <div class="hero-content">
                <div class="hero-icon">üéì</div>
                <h1 class="hero-title">Qu·∫£n l√Ω H·ªçc b·ªïng</h1>
                <p class="hero-subtitle">{{getTableTitle()}} (GPA >= 3.6)</p>
            </div>
            <div class="hero-stats" *ngIf="candidates.length > 0">
                <div class="stat-card">
                    <div class="stat-number">{{candidates.length}}</div>
                    <div class="stat-label">·ª®ng c·ª≠ vi√™n</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{getAverageGPA() | number:'1.2-2'}}</div>
                    <div class="stat-label">GPA TB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{getTopGPA() | number:'1.2-2'}}</div>
                    <div class="stat-label">GPA cao nh·∫•t</div>
                </div>
            </div>
        </div>

        <!-- Smart Filters -->
        <div class="smart-filters">
            <div class="filters-header">
                <h3>üîç B·ªô l·ªçc {{getTableTitle().toLowerCase()}} (GPA >= 3.6)</h3>
                <div class="header-actions">
                    <button class="reset-btn" (click)="resetFilters()" *ngIf="hasActiveFilters()">
                        <i class="icon">üîÑ</i> ƒê·∫∑t l·∫°i
                    </button>
                    <button class="export-btn" (click)="exportScholarshipList()"
                        [disabled]="!candidates.length || exporting">
                        <i class="icon">{{exporting ? 'üì§' : 'üìä'}}</i>
                        {{exporting ? 'ƒêang xu·∫•t...' : 'Xu·∫•t CSV'}}
                    </button>
                </div>
            </div>

            <div class="filters-grid">
                <div class="filter-card">
                    <div class="filter-icon">üèõÔ∏è</div>
                    <div class="filter-content">
                        <label>Khoa</label>
                        <select [(ngModel)]="selectedDepartmentId" (change)="onFilterChange()" class="modern-select">
                            <option value="" disabled selected hidden>-- Ch·ªçn khoa --</option>
                            <option value="">T·∫•t c·∫£ khoa</option>
                            <option *ngFor="let dept of departments" [value]="dept.id">{{dept.name}}</option>
                        </select>
                    </div>
                </div>

                <div class="filter-card">
                    <div class="filter-icon">üìÖ</div>
                    <div class="filter-content">
                        <label>H·ªçc k·ª≥</label>
                        <select [(ngModel)]="selectedSemester" (change)="onFilterChange()" class="modern-select">
                            <option value="" disabled selected hidden></option>
                            <option value="">T·∫•t c·∫£ h·ªçc k·ª≥</option>
                            <option *ngFor="let semester of semesters" [value]="semester.semester"> K·ª≥
                                {{semester.semester}}
                            </option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div *ngIf="loading" class="loading-section">
            <div class="loading-animation">
                <div class="loading-circle"></div>
                <div class="loading-circle"></div>
                <div class="loading-circle"></div>
            </div>
            <p class="loading-text">ƒêang t√¨m {{getTableTitle().toLowerCase()}} (GPA >= 3.6)...</p>
        </div>

        <!-- Error -->
        <div *ngIf="error" class="error-section">
            <div class="error-icon">‚ùå</div>
            <h3>C√≥ l·ªói x·∫£y ra</h3>
            <p>{{error}}</p>
            <button class="retry-btn" (click)="loadScholarshipCandidates()">üîÑ Th·ª≠ l·∫°i</button>
        </div>

        <!-- Results -->
        <div *ngIf="!loading && candidates.length > 0" class="results-section">
            <div class="results-header">
                <h3>üéØ {{getTableTitle()}} ({{candidates.length}} sinh vi√™n)</h3>
            </div>

            <!-- Table View -->
            <div class="table-view">
                <div class="table-container">
                    <table class="scholarship-table">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Sinh vi√™n</th>
                                <th>L·ªõp</th>
                                <th>Khoa</th>
                                <th>GPA</th>
                                <th>T√≠n ch·ªâ</th>
                                <th>Ho√†n th√†nh</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let candidate of candidates; let i = index" class="top-1">
                                <td class="rank-cell">
                                    <div class="rank-badge gold">
                                        <!-- S·ªë th·ª© t·ª± -->
                                        <span class="rank-number">{{ i + 1 }}</span>

                                        <!-- Icon v√†ng -->
                                        <span class="rank-icon">ü•á</span>
                                    </div>
                                </td>

                                <td class="student-cell">
                                    <div class="student-info">
                                        <div class="student-name">{{candidate.fullName}}</div>
                                        <div class="student-code">{{candidate.studentCode}}</div>
                                    </div>
                                </td>

                                <td class="class-cell">{{candidate.className}}</td>
                                <td class="department-cell">{{candidate.departmentName}}</td>

                                <td class="gpa-cell">
                                    <div class="gpa-badge" [class.excellent]="candidate.gpa >= 3.6"
                                        [class.good]="candidate.gpa >= 3.2 && candidate.gpa < 3.6"
                                        [class.average]="candidate.gpa < 3.2">
                                        {{candidate.gpa | number:'1.2-2'}}
                                    </div>
                                </td>

                                <td class="credits-cell">{{candidate.totalCredits}}</td>

                                <td class="completion-cell">
                                    <div class="completion-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" [style.width.%]="getCompletionRate(candidate)">
                                            </div>
                                        </div>
                                        <span class="completion-text">
                                            {{candidate.completedCredits}}/{{candidate.totalCredits}}
                                            ({{getCompletionRate(candidate) | number:'1.0-0'}}%)
                                        </span>
                                    </div>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- No Results -->
        <div *ngIf="!loading && !error && candidates.length === 0 && searchPerformed" class="no-results">
            <div class="no-results-icon">üéì</div>
            <h3>Kh√¥ng c√≥ k·∫øt qu·∫£</h3>
            <p>Kh√¥ng c√≥ sinh vi√™n n√†o ƒë·∫°t y√™u c·∫ßu GPA >= 3.6 trong ƒëi·ªÅu ki·ªán ƒë∆∞·ª£c ch·ªçn.</p>
            <button class="search-again-btn" (click)="resetFilters()">üîÑ T√¨m ki·∫øm l·∫°i</button>
        </div>
    </div>
</app-layout>