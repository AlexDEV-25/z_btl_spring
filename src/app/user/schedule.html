<app-layout [menuItems]="menuItems" [userName]="userName" [userRole]="'Sinh viÃªn'">
  <div class="main-card">
    <div class="page-header">
      <h3>ğŸ“… Thá»i khÃ³a biá»ƒu cá»§a tÃ´i</h3>
      <div class="header-controls">
        <select class="semester-select" [(ngModel)]="selectedSemester" (change)="onSemesterChange()">
          <option *ngFor="let semester of availableSemesters" [value]="semester.semester">
            {{ semester.displayName }}
          </option>
        </select>
      </div>
    </div>

    <div class="card-body">
      <div *ngIf="loading" class="loading-message">â³ Äang táº£i thá»i khÃ³a biá»ƒu...</div>

      <!-- Student Info Summary -->
      <div *ngIf="schedule && !loading" class="info-card">
        <div class="info-row">
          <span class="info-label">ğŸ‘¨â€ğŸ“ Sinh viÃªn:</span>
          <span class="info-value">{{ schedule.studentName }} ({{ schedule.studentCode }})</span>
        </div>
        <div class="info-row">
          <span class="info-label">ğŸ“š Há»c ká»³:</span>
          <span class="info-value">{{ selectedSemester }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ğŸ¯ Tá»•ng tÃ­n chá»‰:</span>
          <span class="info-value">{{ schedule.totalCredits }} <span class="credit-badge">TC</span></span>
        </div>
      </div>

      <div *ngIf="!loading && (!schedule || schedule.scheduleItems.length === 0)" class="no-data">
        <div class="no-data-icon">ğŸ“š</div>
        <button class="btn btn-primary" (click)="goToRegistration()">
          â• ÄÄƒng kÃ½ mÃ´n há»c
        </button>
      </div>

      <div *ngIf="!loading && schedule && schedule.scheduleItems.length > 0" class="timetable">
        <!-- Day headers -->
        <div class="corner-cell">
          Tiáº¿t / Thá»©
        </div>
        <div class="day-header" *ngFor="let d of days" [style.gridColumn]="(d.index + 1)" [style.gridRow]="1">
          <div class="day-name">{{ d.label }}</div>
          <div class="day-date">{{ d.date }}</div>
        </div>

        <!-- Period labels and background slots -->
        <ng-container *ngFor="let p of periods; let r = index">
          <!-- Left time/period column -->
          <div class="period-cell" [style.gridRow]="(r + 2)" [style.gridColumn]="1">
            <div class="period-num">Tiáº¿t {{ p }}</div>
            <div class="period-time">{{ getPeriodTime(p) }}</div>
            <div class="period-session" [class.morning]="p <= 5" [class.afternoon]="p >= 6">
              {{ p <= 5 ? 'SÃ¡ng' : 'Chiá»u' }} </div>
            </div>

            <!-- Background slots for each day -->
            <div class="slot-cell" *ngFor="let d of days" [style.gridRow]="(r + 2)" [style.gridColumn]="(d.index + 1)">
            </div>
        </ng-container>

        <!-- Event blocks -->
        <div class="event" *ngFor="let e of events" [style.gridColumn]="(e.dayIndex + 1)"
          [style.gridRow]="(e.start + 1) + ' / ' + (e.end + 1)" [style.borderLeftColor]="e.color"
          [title]="getEventTooltip(e)">
          <div class="event-title">{{ e.title }}</div>
          <div class="event-lecturer" *ngIf="e.lecturer">ğŸ‘¨â€ğŸ« {{ e.lecturer }}</div>
          <div class="event-room" *ngIf="e.room">ğŸ¢ {{ e.room }}</div>
          <div class="event-meta">
            <span class="event-time">â° {{ getPeriodTime(e.start) }} - {{ getPeriodTime(e.end - 1, true) }}</span>
            <span class="event-credit">ğŸ“š {{ e.credit }} TC</span>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div *ngIf="schedule && schedule.scheduleItems.length > 0" class="quick-actions">
        <button class="btn btn-secondary" (click)="goToGrades()">
          ğŸ“Š Xem báº£ng Ä‘iá»ƒm
        </button>
        <button class="btn btn-primary" (click)="goToRegistration()">
          â• ÄÄƒng kÃ½ thÃªm mÃ´n
        </button>
        <button class="btn btn-info" (click)="exportSchedule()">
          ğŸ“„ Xuáº¥t thá»i khÃ³a biá»ƒu
        </button>
      </div>
    </div>
  </div>
</app-layout>